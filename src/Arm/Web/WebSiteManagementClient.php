<?php

/**
 * Code generated by Microsoft (R) AutoRest Code Generator 0.17.0.0
 * Changes may cause incorrect behavior and will be lost if the code is
 * regenerated.
 *
 * PHP version: 5.5
 *
 * @category    Microsoft
 *
 * @author      Azure PHP SDK <azurephpsdk@microsoft.com>
 * @copyright   2016 Microsoft Corporation
 * @license     https://github.com/Azure/azure-sdk-for-php/blob/arm/LICENSE
 *
 * @link        https://github.com/Azure/azure-sdk-for-php/tree/arm
 *
 * @version     Release: 0.10.0_2016, API Version: 2015-08-01
 */

namespace MicrosoftAzure\Arm\Web;

use MicrosoftAzure\Common\Internal\Authentication\OAuthScheme;
use MicrosoftAzure\Common\Internal\Filters\OAuthFilter;
use MicrosoftAzure\Common\Internal\Http\HttpClient;
use MicrosoftAzure\Common\Internal\Resources;
use MicrosoftAzure\Common\Internal\Serialization\JsonSerializer;
use MicrosoftAzure\Common\OAuthServiceClient;
use MicrosoftAzure\Common\RestServiceClient;

/**
 * Use these APIs to manage Azure Websites resources through the Azure Resource Manager. All task operations conform to the HTTP/1.1 protocol specification and each operation returns an x-ms-request-id header that can be used to obtain information about the request. You must make sure that requests made to these resources are secure. For more information, see <a href="https://msdn.microsoft.com/en-us/library/azure/dn790557.aspx">Authenticating Azure Resource Manager requests.</a>
 */
class WebSiteManagementClient extends RestServiceClient
{
    /**
     * Credentials needed for the client to connect to Azure.
     *
     * @var OAuthSettings
     */
    private $_credentials;
    /**
     * Subscription Id
     *
     * @var string
     */
    private $_subscriptionId;
    /**
     * API Version
     *
     * @var string
     */
    private $_apiVersion;
    /**
     * Gets or sets the preferred language for the response.
     *
     * @var string
     */
    private $_acceptLanguage;
    /**
     * Gets or sets the retry timeout in seconds for Long Running Operations.
     * Default value is 30.
     *
     * @var int
     */
    private $_longRunningOperationRetryTimeout;
    /**
     * When set to true a unique x-ms-client-request-id value is generated and
     * included in each request. Default is true.
     *
     * @var bool
     */
    private $_generateClientRequestId;

    /**
     * Method group: CertificateOrders.
     *
     * @var CertificateOrders
     */
    private $_certificateOrders;

    /**
     * Method group: Certificates.
     *
     * @var Certificates
     */
    private $_certificates;

    /**
     * Method group: ClassicMobileServices.
     *
     * @var ClassicMobileServices
     */
    private $_classicMobileServices;

    /**
     * Method group: Domains.
     *
     * @var Domains
     */
    private $_domains;

    /**
     * Method group: GlobalModel.
     *
     * @var GlobalModel
     */
    private $_globalModel;

    /**
     * Method group: GlobalCertificateOrder.
     *
     * @var GlobalCertificateOrder
     */
    private $_globalCertificateOrder;

    /**
     * Method group: GlobalDomainRegistration.
     *
     * @var GlobalDomainRegistration
     */
    private $_globalDomainRegistration;

    /**
     * Method group: GlobalResourceGroups.
     *
     * @var GlobalResourceGroups
     */
    private $_globalResourceGroups;

    /**
     * Method group: HostingEnvironments.
     *
     * @var HostingEnvironments
     */
    private $_hostingEnvironments;

    /**
     * Method group: ManagedHostingEnvironments.
     *
     * @var ManagedHostingEnvironments
     */
    private $_managedHostingEnvironments;

    /**
     * Method group: Provider.
     *
     * @var Provider
     */
    private $_provider;

    /**
     * Method group: Recommendations.
     *
     * @var Recommendations
     */
    private $_recommendations;

    /**
     * Method group: ServerFarms.
     *
     * @var ServerFarms
     */
    private $_serverFarms;

    /**
     * Method group: Sites.
     *
     * @var Sites
     */
    private $_sites;

    /**
     * Method group: TopLevelDomains.
     *
     * @var TopLevelDomains
     */
    private $_topLevelDomains;

    /**
     * Method group: UsageOperations.
     *
     * @var UsageOperations
     */
    private $_usageOperations;

    /**
     * Base Url for the API.
     *
     * @var string
     */
    private $_baseUrl = 'https://management.azure.com';

    /**
     * Header filters for http calls.
     *
     * @var array
     */
    private $_filters;

    /**
     * Retry intervals in number of seconds.
     *
     * @var int
     */
    private $_retryInterval;

    /**
     * Constructor for the service client.
     *
     * @param OAuthSettings $oauthSettings OAuth settings for to access the APIs
     */
    public function __construct($oauthSettings)
    {
        $this->_credentials = $oauthSettings;
        parent::__construct(
            $this->_credentials->getOAuthEndpointUri(),
            new JsonSerializer()
        );
        $oauthService = new OAuthServiceClient($this->_credentials);
        $authentification = new OAuthScheme($oauthService);
        $this->_filters = [new OAuthFilter($authentification)];

        $this->_certificateOrders = new CertificateOrders($this);
        $this->_certificates = new Certificates($this);
        $this->_classicMobileServices = new ClassicMobileServices($this);
        $this->_domains = new Domains($this);
        $this->_globalModel = new GlobalModel($this);
        $this->_globalCertificateOrder = new GlobalCertificateOrder($this);
        $this->_globalDomainRegistration = new GlobalDomainRegistration($this);
        $this->_globalResourceGroups = new GlobalResourceGroups($this);
        $this->_hostingEnvironments = new HostingEnvironments($this);
        $this->_managedHostingEnvironments = new ManagedHostingEnvironments($this);
        $this->_provider = new Provider($this);
        $this->_recommendations = new Recommendations($this);
        $this->_serverFarms = new ServerFarms($this);
        $this->_sites = new Sites($this);
        $this->_topLevelDomains = new TopLevelDomains($this);
        $this->_usageOperations = new UsageOperations($this);

        $this->setApiVersion('2015-08-01');
        $this->setAcceptLanguage('en-US');
        $this->setLongRunningOperationRetryTimeout(30);
        $this->setGenerateClientRequestId(true);
        $this->setRetryInterval(5);
    }

    /**
     * Gets credentials, Credentials needed for the client to connect to Azure.
     *
     * @return OAuthSettings
     */
    public function getCredentials()
    {
        return $this->_credentials;
    }

    /**
     * Sets credentials, Credentials needed for the client to connect to Azure.
     *
     * @param OAuthSettings $credentials
     *
     * @return none
     */
    private function setCredentials($credentials)
    {
        $this->_credentials = $credentials;
    }

    /**
     * Gets subscriptionId, Subscription Id
     *
     * @return string
     */
    public function getSubscriptionId()
    {
        return $this->_subscriptionId;
    }

    /**
     * Sets subscriptionId, Subscription Id
     *
     * @param string $subscriptionId
     *
     * @return none
     */
    public function setSubscriptionId($subscriptionId)
    {
        $this->_subscriptionId = $subscriptionId;
    }

    /**
     * Gets apiVersion, API Version
     *
     * @return string
     */
    public function getApiVersion()
    {
        return $this->_apiVersion;
    }

    /**
     * Sets apiVersion, API Version
     *
     * @param string $apiVersion
     *
     * @return none
     */
    private function setApiVersion($apiVersion)
    {
        $this->_apiVersion = $apiVersion;
    }

    /**
     * Gets acceptLanguage, the preferred language for the response.
     *
     * @return string
     */
    public function getAcceptLanguage()
    {
        return $this->_acceptLanguage;
    }

    /**
     * Sets acceptLanguage, the preferred language for the response.
     *
     * @param string $acceptLanguage
     *
     * @return none
     */
    public function setAcceptLanguage($acceptLanguage)
    {
        $this->_acceptLanguage = $acceptLanguage;
    }

    /**
     * Gets longRunningOperationRetryTimeout, the retry timeout in seconds for
     * Long Running Operations. Default value is 30.
     *
     * @return int
     */
    public function getLongRunningOperationRetryTimeout()
    {
        return $this->_longRunningOperationRetryTimeout;
    }

    /**
     * Sets longRunningOperationRetryTimeout, the retry timeout in seconds for
     * Long Running Operations. Default value is 30.
     *
     * @param int $longRunningOperationRetryTimeout
     *
     * @return none
     */
    public function setLongRunningOperationRetryTimeout($longRunningOperationRetryTimeout)
    {
        $this->_longRunningOperationRetryTimeout = $longRunningOperationRetryTimeout;
        set_time_limit($longRunningOperationRetryTimeout);
    }

    /**
     * Gets generateClientRequestId, When set to true a unique
     * x-ms-client-request-id value is generated and included in each
     * request. Default is true.
     *
     * @return bool
     */
    public function getGenerateClientRequestId()
    {
        return $this->_generateClientRequestId;
    }

    /**
     * Sets generateClientRequestId, When set to true a unique
     * x-ms-client-request-id value is generated and included in each
     * request. Default is true.
     *
     * @param bool $generateClientRequestId
     *
     * @return none
     */
    public function setGenerateClientRequestId($generateClientRequestId)
    {
        $this->_generateClientRequestId = $generateClientRequestId;
    }

    /**
     * Gets method group CertificateOrders.
     *
     * @return CertificateOrders
     */
    public function getCertificateOrders()
    {
        return $this->_certificateOrders;
    }

    /**
     * Gets method group Certificates.
     *
     * @return Certificates
     */
    public function getCertificates()
    {
        return $this->_certificates;
    }

    /**
     * Gets method group ClassicMobileServices.
     *
     * @return ClassicMobileServices
     */
    public function getClassicMobileServices()
    {
        return $this->_classicMobileServices;
    }

    /**
     * Gets method group Domains.
     *
     * @return Domains
     */
    public function getDomains()
    {
        return $this->_domains;
    }

    /**
     * Gets method group GlobalModel.
     *
     * @return GlobalModel
     */
    public function getGlobalModel()
    {
        return $this->_globalModel;
    }

    /**
     * Gets method group GlobalCertificateOrder.
     *
     * @return GlobalCertificateOrder
     */
    public function getGlobalCertificateOrder()
    {
        return $this->_globalCertificateOrder;
    }

    /**
     * Gets method group GlobalDomainRegistration.
     *
     * @return GlobalDomainRegistration
     */
    public function getGlobalDomainRegistration()
    {
        return $this->_globalDomainRegistration;
    }

    /**
     * Gets method group GlobalResourceGroups.
     *
     * @return GlobalResourceGroups
     */
    public function getGlobalResourceGroups()
    {
        return $this->_globalResourceGroups;
    }

    /**
     * Gets method group HostingEnvironments.
     *
     * @return HostingEnvironments
     */
    public function getHostingEnvironments()
    {
        return $this->_hostingEnvironments;
    }

    /**
     * Gets method group ManagedHostingEnvironments.
     *
     * @return ManagedHostingEnvironments
     */
    public function getManagedHostingEnvironments()
    {
        return $this->_managedHostingEnvironments;
    }

    /**
     * Gets method group Provider.
     *
     * @return Provider
     */
    public function getProvider()
    {
        return $this->_provider;
    }

    /**
     * Gets method group Recommendations.
     *
     * @return Recommendations
     */
    public function getRecommendations()
    {
        return $this->_recommendations;
    }

    /**
     * Gets method group ServerFarms.
     *
     * @return ServerFarms
     */
    public function getServerFarms()
    {
        return $this->_serverFarms;
    }

    /**
     * Gets method group Sites.
     *
     * @return Sites
     */
    public function getSites()
    {
        return $this->_sites;
    }

    /**
     * Gets method group TopLevelDomains.
     *
     * @return TopLevelDomains
     */
    public function getTopLevelDomains()
    {
        return $this->_topLevelDomains;
    }

    /**
     * Gets method group UsageOperations.
     *
     * @return UsageOperations
     */
    public function getUsageOperations()
    {
        return $this->_usageOperations;
    }

    /**
     * Gets filter for http requests.
     *
     * @return array, OAuth filters
     */
    public function getFilters()
    {
        return $this->_filters;
    }

    /**
     * Gets the data serializer.
     *
     * @return JsonSerializer, the data serializer
     */
    public function getDataSerializer()
    {
        return $this->dataSerializer;
    }

    /**
     * Gets host full Url for a relative path.
     *
     * @param string $path
     *
     * @return string, full Url
     */
    public function getUrl($path)
    {
        return $this->_baseUrl.$path;
    }

    /**
     * Gets retry intervals in number of seconds.
     *
     * @return int, number of seconds
     */
    public function getRetryInterval()
    {
        return $this->_retryInterval;
    }

    /**
     * Sets retry intervals in number of seconds.
     *
     * @param int $retryInterval
     *
     * @return none
     */
    public function setRetryInterval($retryInterval)
    {
        $this->_retryInterval = $retryInterval;
    }

    /**
     * Poll for the async status of a request.
     *
     * @param string $path
     * @param string $requestId from x-ms-request-id in the header
     *
     * @return string, status code, 200 or 202
     */
    public function pollAsyncOperation($path, $requestId)
    {
        $queryParams = [Resources::API_VERSION => '2015-08-01', 'monitor' => 'true'];
        $method = Resources::HTTP_GET;
        $statusCodes = [Resources::STATUS_OK, Resources::STATUS_ACCEPTED];

        $headers = [Resources::X_MS_REQUEST_ID => $requestId];
        $body = '';

        $response = HttpClient::send(
            $method,
            $headers,
            $queryParams,
            [],
            $path,
            $statusCodes,
            $body,
            $this->getFilters()
        );

        return $response->getStatusCode();
    }

    /**
     * Wait for the async request to finish.
     *
     * @param Response $response
     *
     * @return string, status code
     */
    public function awaitAsync($response)
    {
        $status = $response->getStatusCode();
        $headers = $response->getHeaders();

        if (array_key_exists(Resources::XTAG_LOCATION, $headers) && array_key_exists(Resources::X_MS_REQUEST_ID, $headers)) {
            $locations = $headers[Resources::XTAG_LOCATION];
            $requestIds = $headers[Resources::X_MS_REQUEST_ID];

            while ($status == Resources::STATUS_ACCEPTED) {
                sleep($this->getRetryInterval());
                $status = $this->pollAsyncOperation($locations[0], $requestIds[0]);
                echo '.';
            }
        }

        return $status;
    }
}
